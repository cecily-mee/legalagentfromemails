# Autonomous Zero Draft Legal AI Agent

This project is an autonomous AI agent built with **LangGraph** and **multimodal LLMs** (Google Gemini) to automate a legal team's email inbox. The system reads new emails, understands both text and PDF attachments, triages requests, and automates responses‚Äîtransforming the legal expert's role from a manual drafter to an **expert reviewer**.

## üéØ The Problem

Legal teams are often a bottleneck in business operations, buried under a constant flood of email requests. These can range from simple internal queries and reviews of third-party documents to urgent requests for new contract drafts. Manually managing this inbox is time-consuming, repetitive, and slows down the entire company.

## üí° The Solution

This agent acts as a "digital paralegal" that monitors the inbox 24/7. It autonomously ingests and understands every new request, using AI to decide the correct course of action.

* **For queries & reviews:** It uses **Retrieval-Augmented Generation (RAG)** to query an internal knowledge base of legal playbooks, then drafts a complete email reply.
* **For contract drafts:** It uses a separate RAG system to find the correct legal template, intelligently fills it with data from the email, and saves the final draft to a database.

The legal expert's job is now simply to approve the drafted email or review the generated contract on a dashboard, saving hours of manual work.

## ‚ú® Key Features

* **Multimodal Ingestion:** The agent doesn't just read email text. It uses `pdf2image` to convert all pages from attached PDFs into images, allowing the multimodal AI to **read and understand scanned documents, forms, and third-party contracts**.
* **Autonomous Triage:** A multimodal **Gemini**-powered agent analyzes the email text and attachment images to classify the task (e.g., `Contract Draft Request`, `Legal Query`, `Contract Review`).
* **Dual-RAG Architecture:**
    1.  **ChromaDB:** A vector store for answering legal queries, loaded with text-based "playbook" documents.
    2.  **Pinecone:** A vector store for contract drafting, loaded with embeddable PDF contract templates.
* **Stateful Agent Workflow:** Built with **LangGraph**, the system manages a complex, multi-step process with loops (e.g., `write_email` -> `proofread` -> `rewrite`) for robust execution.
* **Human-in-the-Loop (HITL) Dashboard:** A **FastAPI** server provides API endpoints to view, edit, and export contracts generated by the agent, turning the lawyer into a reviewer.

## ‚öôÔ∏è Architecture & Workflow

The system is built as a state machine using LangGraph.

*(You can add a diagram of your workflow here, e.g., `![Workflow Diagram](docs/workflow.png)`)*

1.  **Fetch:** The `GmailToolsClass` fetches unread emails.
2.  **Extract:** The tool extracts the email body. Crucially, it also finds all PDF attachments, decodes them, and uses `pdf2image` to convert **every page into a base64-encoded image**.
3.  **Categorize:** The email text and all attachment images are sent to the `categorize_email` agent (Gemini). This multimodal agent determines the user's true intent and classifies the email.
4.  **Route:** The LangGraph workflow routes the task based on its category.
    * **Path A: Legal Query / Contract Review**
        * The `construct_rag_queries` agent (Gemini) reads the email and generates questions.
        * The `retrieve_from_rag` node queries a **ChromaDB** vector store (containing legal playbooks) to get answers.
        * The `email_writer` agent (Gemini) receives the context and drafts a reply.
        * The `email_proofreader` agent (Gemini) checks the draft. If it's not sendable, it loops back to the writer with feedback.
        * Once approved, a draft reply is created in the user's Gmail.
    * **Path B: Contract Draft Request**
        * The task is routed to the `generate_contract_from_email` node.
        * This node uses the `ContractRAGAgent`, which queries a **Pinecone** vector store (containing contract templates) to find the relevant template.
        * The agent generates a complete contract, filling in details from the email.
        * The final contract is saved to **MongoDB**.
    * **Path C: Unrelated**
        * The email is marked as read and skipped.
5.  **Review (HITL):** The `api_server.py` (FastAPI) serves the generated contracts from MongoDB, allowing a legal expert to review, edit, and export them as PDFs from a web dashboard.

## üõ†Ô∏è Key Technical Decisions

* **Why LangGraph?** A simple LLM chain cannot handle the complex, stateful logic of this task. We need a graph to manage state, route between different agents, and handle cycles (like the "rewrite" loop from the proofreader).
* **Why Multimodal (Gemini)?** Legal requests are rarely just text. The *real* request is often inside a scanned PDF. A text-only model would fail. By converting PDF pages to images, our Gemini agent can *see* the attachments and understand the full context.
* **Why a Dual-RAG System (ChromaDB + Pinecone)?** To separate concerns.
    * **ChromaDB** is used for our *unstructured* knowledge base (legal playbooks, FAQs) to answer questions.
    * **Pinecone** is used as a *template retriever*. It's optimized for finding the best *full document template* to use as a base for generation.
* **Why MongoDB?** It's the perfect database for this system, allowing us to store the semi-structured, document-based output (the generated contracts) and serve them easily via our FastAPI backend.

## üöÄ Getting Started

### 1. Prerequisites

* Python 3.10+
* Google Cloud Project with Gmail API and Vertex AI (for Gemini) enabled.
* Accounts for [Pinecone](https://www.pinecone.io/), [MongoDB Atlas](https://www.mongodb.com/cloud/atlas), and [Groq](https://groq.com/).
* `poppler` (a dependency for `pdf2image`):
    ```bash
    # On macOS
    brew install poppler
    # On Ubuntu/Debian
    sudo apt-get install poppler-utils
    ```

### 2. Clone & Install

```bash
# Clone the repository
git clone [https://github.com/your-username/your-repo-name.git](https://github.com/your-username/your-repo-name.git)
cd your-repo-name

# Create and activate a virtual environment
python -m venv venv
source venv/bin/activate

# Install dependencies (create a requirements.txt file)
pip install -r requirements.txt

### 3. Environment Setup

Create a `.env` file in the root directory and add your API keys

### 4. Google Gmail API Setup

1.  Go to your Google Cloud Console.
2.  Enable the **Gmail API**.
3.  Create OAuth 2.0 Client IDs credentials.
4.  Download the JSON file and rename it `credentials.json` in the root of your project.
5.  The first time you run `main.py`, you will be prompted to authenticate in your browser. This will create a `token.json` file.

### 5. Populate Knowledge Bases

1.  **ChromaDB (Legal Playbooks):**
    * Add your internal legal documents, FAQs, etc., to `data/agency.txt`.
    * Run the `create_index.py` script to build the ChromaDB vector store:
        ```bash
        python create_index.py
        ```
2.  **Pinecone (Contract Templates):**
    * Place all your `.pdf` contract templates (e.g., `NDA-Template.pdf`, `MSA-Template.pdf`) inside the `documents/` folder.
    * The `ContractRAGAgent` will automatically load and embed these into your Pinecone index the first time it's initialized (in `main.py`).

### 6. Run the Application

This system has multiple services. You should run them in separate terminal tabs.

**Tab 1: Run the main LangGraph Agent**
This will start the agent, which will begin monitoring your inbox.

```bash
# (Make sure venv is active)
python main.py

**Tab 2: Run the FastAPI Dashboard API This server provides the backend for the legal expert's review dashboard.
```bash
uvicorn api_server:app --reload --port 8080
